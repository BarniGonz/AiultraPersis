<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Chatbot with Photo Analysis & Advanced Memory - Powered by Barni</title>
  
  <!-- External Libraries -->
  <script src="https://js.puter.com/v2/"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" media="(prefers-color-scheme: dark)">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  
  <!-- Local CSS -->
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <div class="toast-container" id="toast-container"></div>
  
  <!-- Activation Animation -->
  <div class="activation-animation" id="activation-animation">
    <div class="activation-content">
      <div class="activation-checkmark">‚úì</div>
      <h3>Key Activated Successfully!</h3>
      <p>User authenticated for AI access...</p>
    </div>
  </div>
  
  <div class="sync-status" id="sync-status">
    <div class="sync-spinner"></div>
    <span id="sync-message">Connecting to GoFile cloud...</span>
  </div>
  
  <div class="connection-status" id="connection-status">
    <div class="connection-indicator" id="connection-indicator"></div>
    <span id="connection-text">Connecting...</span>
  </div>
  
  <!-- Image Modal -->
  <div id="imageModal" class="image-modal">
    <span class="close-modal" onclick="closeImageModal()">&times;</span>
    <img class="image-modal-content" id="modalImage">
  </div>
  
  <header>
    <span class="powered-by">AI CHATBOT WITH PHOTO ANALYSIS & ADVANCED MEMORY - POWERED BY BARNI</span>
  </header>
  
  <div class="app-container">
    <!-- FIXED: Firebase UID-Based Key Activation Panel -->
    <div class="key-panel" id="key-panel">
      <div class="realtime-indicator" id="realtime-indicator"></div>
      <div class="key-header">
        <div class="key-status" id="key-status">
          üîê Key Status: Checking authentication...
          <span class="countdown" id="key-countdown" style="display: none;"></span>
        </div>
        <button class="key-toggle-btn" id="key-toggle-btn" onclick="toggleKeyPanel()">
          Activate
        </button>
      </div>
      
      <div class="user-status" id="user-status">
        <span>üîç Authenticating with Firebase...</span>
      </div>
      
      <div class="key-details" id="key-details">
        <div class="key-input-group">
          <input type="text" class="key-input" id="key-input" placeholder="Enter your activation key..." maxlength="20">
          <button class="key-submit-btn" id="key-submit-btn" onclick="activateKey()">
            Activate
          </button>
        </div>
        <div id="key-info" class="key-info"></div>
        <div id="key-countdown-display" class="key-countdown" style="display: none;"></div>
      </div>
    </div>
    
    <div class="memory-panel" id="memory-panel" style="display: none;">
      <div class="memory-title">
        üß† Advanced Memory Bank (GoFile Cloud)
        <button id="clear-memory-btn" style="margin-left: auto; padding: 0.25rem 0.5rem; font-size: 0.75rem;">Clear Memory</button>
      </div>
      <div id="memory-content"></div>
    </div>
    
    <div id="controls-container">
      <div id="model-selector-container">
        <label for="model-select" class="theme-toggle-label">Choose AI Model:</label>
        <select id="model-select" aria-label="Select AI model"></select>
        <div class="theme-toggle">
          <label for="theme-toggle" class="theme-toggle-label">Toggle Theme</label>
          <div class="theme-toggle-switch">
            <input type="checkbox" id="theme-toggle" aria-label="Toggle between light and dark theme">
            <span class="theme-toggle-slider"></span>
          </div>
        </div>
      </div>
      <div id="conversation-controls">
        <label for="conversation-select" class="theme-toggle-label">Conversation:</label>
        <select id="conversation-select" aria-label="Select conversation"></select>
        <div class="conversation-controls">
          <button id="new-conversation-btn" aria-label="Start new conversation">New</button>
          <button id="delete-conversation-btn" aria-label="Delete current conversation">Delete</button>
        </div>
      </div>
    </div>
    
    <!-- Image Preview Container -->
    <div id="image-preview-container" class="image-preview-container" style="display: none;">
      <div id="image-previews"></div>
    </div>
    
    <div id="chat-container"></div>
    
    <div id="input-container">
      <input type="text" id="user-input" placeholder="Type your message..." autocomplete="off" aria-label="Type your message">
      <div class="input-actions">
        <button id="photo-btn" aria-label="Attach photo">
          üì∑
          <input type="file" id="file-input" accept="image/*" multiple>
        </button>
        <button id="send-btn" aria-label="Send message">Send</button>
      </div>
    </div>
  </div>
  
  <footer>
    <div class="footer-links">
      <a href="mailto:barnigonzales43329@gmail.com" class="contact-link" aria-label="Contact via email">CONTACT</a>
      <a href="#" class="key-link" id="key-link" onclick="toggleKeyPanel()">KEY</a>
    </div>
  </footer>
  
  <!-- Firebase Integration -->
  <script type="module" src="index1.js"></script>
  <!-- Core Application Logic -->
  <script src="index.js"></script>
  <!-- Key System -->
  <script src="index2.js"></script>
  <!-- Additional Features -->
  <script src="index3.js"></script>
</body>
</html>